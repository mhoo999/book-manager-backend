<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>ë„ì„œ ìˆ˜ì • - ë¶ë§¤ë‹ˆì €</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    @keyframes fade {
      0% {
        opacity: 0.4;
      }
      100% {
        opacity: 1;
      }
    }

    header{position: relative;}
    header>.bg_lnb{
      display: none;
      position: absolute;
      left: 0;
      top: 72px;
      width: 100%;
      height: 120px;
      background-color: rgba(59, 130, 246, 0.15);
      border-top: 3px solid #3b82f6;
      border-bottom: 1px solid #bfdbfe;
      animation: fade 0.3s;
    }

    .container{
      position: relative;
    }
    .container>nav{
      position: absolute;
      right: 0;
      top: 32px;
    }

    .container>nav .lnb{
      display: none;
      margin-top: 32px;
      animation: fade 0.3s;
    }
    .container>nav .lnb>li>a{
      display: block;
      height: 30px;
      line-height: 30px;

    }
    .container>nav .lnb>li>a:hover{
      color: #fff;
      font-weight: 800;
      background-color: #3b82f6;
    }

    .error-message {
      color: #dc2626;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

  </style>
  <script src="/Global/js/GlobalNavBarHover.js" defer></script>
</head>
<body class="bg-gray-50">
<!-- í—¤ë” -->
<header th:replace="~{fragments/header :: siteHeader}"></header>

<!-- ë³¸ë¬¸ -->
<main class="max-w-screen-xl mx-auto px-4 py-8">
  <h2 class="text-2xl font-bold mb-6">ğŸ“˜ ë„ì„œ ìˆ˜ì •</h2>

  <!-- ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ -->
  <div th:if="${message}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4" role="alert">
    <span class="block sm:inline" th:text="${message}"></span>
  </div>

  <!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ -->
  <div th:if="${errorMessage}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
    <span class="block sm:inline" th:text="${errorMessage}"></span>
  </div>

  <div class="bg-white p-6 rounded shadow space-y-8" th:if="${book != null}">

    <form th:action="@{/admin/v1/books/{bookId}/edit(bookId=${book.bookId})}" method="post" class="space-y-8">

      <!-- í‘œì§€ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
      <div class="flex justify-center mb-6">
        <div class="text-center">
          <img id="coverPreview"
               th:src="${book.cover != null ? book.cover : 'https://picsum.photos/200/280'}"
               th:alt="${book.title + ' í‘œì§€'}"
               class="shadow border rounded-md max-w-[200px] max-h-[280px] mb-2">
          <p class="text-sm text-gray-500">í‘œì§€ URL ì…ë ¥ ì‹œ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</p>
        </div>
      </div>

      <!-- ìˆ˜ì • ë¶ˆê°€ëŠ¥í•œ ì •ë³´ (ì½ê¸° ì „ìš©) -->
      <section>
        <h3 class="text-xl font-semibold mb-4">ë„ì„œ ê³ ì •ì •ë³´ (ìˆ˜ì •ë¶ˆê°€)</h3>
        <div class="grid grid-cols-2 gap-6">
          <div>
            <label class="block text-gray-700 font-medium">ISBN</label>
            <input type="text" th:value="${book.isbn}"
                   class="mt-1 w-full border px-3 py-2 rounded bg-gray-100" readonly>
          </div>
          <div>
            <label class="block text-gray-700 font-medium">ì¹´í…Œê³ ë¦¬ ì½”ë“œ</label>
            <input type="text" th:value="${book.categoryCode}"
                   class="mt-1 w-full border px-3 py-2 rounded bg-gray-100" readonly>
          </div>
          <div>
            <label class="block text-gray-700 font-medium">ì¶œíŒì¼</label>
            <input type="text" th:value="${book.publish_date != null ? #temporals.format(book.publish_date, 'yyyy-MM-dd') : 'N/A'}"
                   class="mt-1 w-full border px-3 py-2 rounded bg-gray-100" readonly>
          </div>
          <div>
            <label class="block text-gray-700 font-medium">ì¬ê³  ìˆ˜ëŸ‰</label>
            <input type="text" th:value="${book.stock + 'ê¶Œ'}"
                   class="mt-1 w-full border px-3 py-2 rounded bg-gray-100" readonly>
          </div>
        </div>
      </section>

      <!-- ìˆ˜ì • ê°€ëŠ¥í•œ ì •ë³´ -->
      <section>
        <h3 class="text-xl font-semibold mb-4">ìˆ˜ì • ê°€ëŠ¥í•œ ì •ë³´</h3>
        <div class="grid grid-cols-1 gap-6">
          <div>
            <label class="block text-gray-700 font-medium">ë„ì„œëª… <span class="text-red-500">*</span></label>
            <input type="text" name="title" th:value="${book.title}" required
                   class="mt-1 w-full border border-gray-300 px-3 py-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-gray-700 font-medium">ì €ì <span class="text-red-500">*</span></label>
            <input type="text" name="author" th:value="${book.author}" required
                   class="mt-1 w-full border border-gray-300 px-3 py-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-gray-700 font-medium">ì¶œíŒì‚¬</label>
            <input type="text" name="publisher" th:value="${book.publisher}"
                   class="mt-1 w-full border border-gray-300 px-3 py-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-gray-700 font-medium">ë„ì„œ ìœ„ì¹˜</label>
            <select name="location" class="mt-1 w-full border border-gray-300 px-3 py-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="">ì„ íƒ</option>
              <option value="A-1" th:selected="${book.location == 'A-1'}">A-1</option>
              <option value="A-2" th:selected="${book.location == 'A-2'}">A-2</option>
              <option value="B-1" th:selected="${book.location == 'B-1'}">B-1</option>
              <option value="B-2" th:selected="${book.location == 'B-2'}">B-2</option>
              <option value="C-1" th:selected="${book.location == 'C-1'}">C-1</option>
              <option value="C-2" th:selected="${book.location == 'C-2'}">C-2</option>
              <option value="C-3" th:selected="${book.location == 'C-3'}">C-3</option>
            </select>
          </div>
          <div>
            <label class="block text-gray-700 font-medium">í‘œì§€ ì´ë¯¸ì§€ URL</label>
            <input type="url" name="cover" th:value="${book.cover}" id="coverInput"
                   class="mt-1 w-full border border-gray-300 px-3 py-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                   placeholder="ì˜ˆ: https://example.com/cover.jpg">
            <p class="text-sm text-gray-500 mt-1">í‘œì§€ ì´ë¯¸ì§€ì˜ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
          </div>
        </div>
      </section>

      <!-- ìˆ˜ëŸ‰ ì •ë³´ (ì½ê¸° ì „ìš©) -->
      <section>
        <h3 class="text-xl font-semibold mb-4">í˜„ì¬ ìˆ˜ëŸ‰ ì •ë³´</h3>
        <div class="grid grid-cols-3 gap-6">
          <div>
            <label class="block text-gray-700 font-medium">ì´ìˆ˜ëŸ‰</label>
            <input type="text" th:value="${book.stock + 'ê¶Œ'}"
                   class="mt-1 w-full border px-3 py-2 rounded bg-gray-100" readonly>
          </div>
          <div>
            <label class="block text-gray-700 font-medium">ëŒ€ì—¬ì¤‘</label>
            <input type="text" th:value="${book.rentedQuantity != null ? book.rentedQuantity + 'ê¶Œ' : '0ê¶Œ'}"
                   class="mt-1 w-full border px-3 py-2 rounded bg-gray-100" readonly>
          </div>
          <div>
            <label class="block text-gray-700 font-medium">ì”ì—¬ìˆ˜ëŸ‰</label>
            <input type="text" th:value="${book.availableQuantity != null ? book.availableQuantity + 'ê¶Œ' : book.stock + 'ê¶Œ'}"
                   class="mt-1 w-full border px-3 py-2 rounded bg-gray-100" readonly>
          </div>
        </div>
      </section>

      <!-- ì„¤ëª… (ìˆëŠ” ê²½ìš°) -->
      <section th:if="${book.description != null and !book.description.isEmpty()}">
        <h3 class="text-xl font-semibold mb-4">ë„ì„œ ì„¤ëª… (ì½ê¸° ì „ìš©)</h3>
        <div class="bg-gray-50 p-4 rounded">
          <p th:text="${book.description}"></p>
        </div>
      </section>

      <!-- ë²„íŠ¼ -->
      <div class="text-right space-x-2">
        <a th:href="@{/admin/v1/books/{bookId}(bookId=${book.bookId})}"
           class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 inline-block">ì·¨ì†Œ</a>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          ìˆ˜ì • ì™„ë£Œ
        </button>
      </div>

      <!-- ì†Œì¥ì‚¬í•­ (ì½ê¸° ì „ìš©) -->
      <section>
        <h3 class="text-xl font-semibold mb-4">ì†Œì¥ì‚¬í•­</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full table-auto border border-gray-200 bg-white">
            <thead class="bg-gray-100">
            <tr class="text-center text-gray-700 font-medium">
              <th class="px-4 py-2 border">ë²ˆí˜¸</th>
              <th class="px-4 py-2 border">ë„ì„œì½”ë“œ</th>
              <th class="px-4 py-2 border">ë„ì„œìœ„ì¹˜</th>
              <th class="px-4 py-2 border">ë„ì„œìƒíƒœ</th>
            </tr>
            </thead>
            <tbody class="text-center text-gray-800">
            <tr th:each="bookItem, iterStat : ${book.books}"
                th:class="${iterStat.even} ? 'bg-gray-50' : ''">
              <td class="px-4 py-2 border" th:text="${iterStat.count}"></td>
              <td class="px-4 py-2 border" th:text="${bookItem.bookCode}"></td>
              <td class="px-4 py-2 border" th:text="${bookItem.location}"></td>
              <td class="px-4 py-2 border">
                <span th:if="${bookItem.status.name() == 'RENTABLE'}" class="text-green-600 font-bold">ëŒ€ì—¬ê°€ëŠ¥</span>
                <span th:if="${bookItem.status.name() == 'RENTED'}" class="text-red-500 font-bold">ëŒ€ì—¬ì¤‘</span>
                <span th:if="${bookItem.status.name() == 'UNRENTABLE'}" class="text-gray-500 font-bold">ëŒ€ì—¬ë¶ˆê°€</span>
              </td>
            </tr>
            <tr th:if="${book.books == null or book.books.isEmpty()}">
              <td colspan="4" class="px-4 py-8 border text-center text-gray-500">
                ë“±ë¡ëœ ë„ì„œ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </section>

    </form>

  </div>

  <!-- ë„ì„œê°€ ì—†ëŠ” ê²½ìš° -->
  <div th:if="${book == null}" class="bg-white p-6 rounded shadow text-center">
    <h3 class="text-xl font-semibold mb-4 text-gray-600">ë„ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
    <a th:href="@{/admin/v1/books}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 inline-block">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>
</main>

<!-- í‘¸í„° -->
<footer class="bg-white border-t mt-12">
  <div class="max-w-screen-xl mx-auto px-4 py-6 text-center text-sm text-gray-500">
    ìƒí˜¸: ë¶ë§¤ë‹ˆì € | ì „í™”: 010-7294-3724 | ì´ë©”ì¼: admin@bookmanager.com
  </div>
</footer>

<script>
  // í‘œì§€ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
  const coverInput = document.getElementById('coverInput');
  const coverPreview = document.getElementById('coverPreview');

  coverInput.addEventListener('input', function() {
    const url = this.value.trim();
    if (url) {
      // ì´ë¯¸ì§€ ë¡œë“œ í…ŒìŠ¤íŠ¸
      const img = new Image();
      img.onload = function() {
        coverPreview.src = url;
      };
      img.onerror = function() {
        // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì´ë¯¸ì§€ ìœ ì§€
        console.log('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', url);
      };
      img.src = url;
    } else {
      // URLì´ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€
      coverPreview.src = 'https://picsum.photos/200/280';
    }
  });

  // í¼ ì œì¶œ ì‹œ í™•ì¸
  document.querySelector('form').addEventListener('submit', function(e) {
    const title = document.querySelector('input[name="title"]').value.trim();
    const author = document.querySelector('input[name="author"]').value.trim();

    if (!title || !author) {
      e.preventDefault();
      alert('ë„ì„œëª…ê³¼ ì €ìëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
      return false;
    }

    // ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
    const submitButton = this.querySelector('button[type="submit"]');
    submitButton.textContent = 'ìˆ˜ì • ì¤‘...';
    submitButton.disabled = true;
  });
</script>
</body>
</html>