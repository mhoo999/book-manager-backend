<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ë¶ë§¤ë‹ˆì €</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @keyframes fade {
      0% {
        opacity: 0.4;
      }
      100% {
        opacity: 1;
      }
    }

    header{position: relative;}
    header>.bg_lnb{
      display: none;
      position: absolute;
      left: 0;
      top: 72px;
      width: 100%;
      height: 120px;
      background-color: rgba(59, 130, 246, 0.15);
      border-top: 3px solid #3b82f6;
      border-bottom: 1px solid #bfdbfe;
      animation: fade 0.3s;
    }

    .container{
      position: relative;
    }
    .container>nav{
      position: absolute;
      right: 0;
      top: 32px;
    }

    .container>nav .lnb{
      display: none;
      margin-top: 32px;
      animation: fade 0.3s;
    }
    .container>nav .lnb>li>a{
      display: block;
      height: 30px;
      line-height: 30px;

    }
    .container>nav .lnb>li>a:hover{
      color: #fff;
      font-weight: 800;
      background-color: #3b82f6;
    }

  </style>
  <script src="/Global/js/GlobalNavBarHover.js" defer></script>
</head>
<body class="bg-gray-50">
<!-- í—¤ë” -->
<header th:replace="~{fragments/header :: siteHeader}"></header>

<!-- ë³¸ë¬¸ -->
<main class="max-w-screen-xl mx-auto px-4 py-8">
  <h2 class="text-2xl font-bold text-center mb-6">ğŸ“š ëŒ€ì—¬ ëª©ë¡</h2>

  <!-- ê²€ìƒ‰ ì˜ì—­ -->
  <form th:action="@{/admin/v1/rents/search}" method="get" class="mb-6">
    <div class="flex flex-wrap justify-center mb-4 space-x-2">
      <select name="searchType" class="border px-3 py-2 rounded">
        <option value="username" th:selected="${searchCondition?.searchType == 'username'}">íšŒì›ëª…</option>
        <option value="userPhone" th:selected="${searchCondition?.searchType == 'userPhone'}">ì—°ë½ì²˜</option>
        <option value="bookName" th:selected="${searchCondition?.searchType == 'bookName'}">ë„ì„œëª…</option>
      </select>
      <input type="text" name="searchKeyword" th:value="${searchCondition?.searchKeyword}"
             class="border px-3 py-2 rounded w-64" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ê²€ìƒ‰</button>
      <a th:href="@{/admin/v1/rents}" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">ì „ì²´ë³´ê¸°</a>
    </div>
  </form>

  <!-- í…Œì´ë¸” -->
  <div class="overflow-x-auto">
    <table class="table-auto w-full bg-white border">
      <thead class="bg-gray-100">
      <tr>
        <th class="text-center py-2 px-2">ëŒ€ì—¬ë²ˆí˜¸</th>
        <th class="text-center py-2 px-2">íšŒì›ëª…</th>
        <th class="text-center py-2 px-2">ë„ì„œë²ˆí˜¸</th>
        <th class="text-center py-2 px-2">ë„ì„œëª…</th>
        <th class="text-center py-2 px-2">ì—°ë½ì²˜</th>
        <th class="text-center py-2 px-2">ëŒ€ì—¬ì¼<br>(ë°˜ë‚©ì˜ˆì •ì¼)</th>
        <th class="text-center py-2 px-2">
          ì§„í–‰ìƒíƒœ
          <select class="ml-2 border text-sm px-1 py-1" onchange="filterByStatus(this.value)">
            <option value="">ì „ì²´ë³´ê¸°</option>
            <option value="REQUESTED">ëŒ€ì—¬ìš”ì²­</option>
            <option value="RENTED">ëŒ€ì—¬ì¤‘</option>
            <option value="RETURNED">ë°˜ë‚©</option>
            <option value="OVERDUE">ë¯¸ë‚©</option>
          </select>
        </th>
      </tr>
      </thead>
      <tbody>
      <!-- ë°ì´í„°ê°€ ì—†ì„ ë•Œ -->
      <tr th:if="${rents.rents.empty}">
        <td colspan="7" class="text-center py-8 text-gray-500">ëŒ€ì—¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td>
      </tr>

      <!-- ë°ì´í„° ë°˜ë³µ -->
      <tr th:each="rent : ${rents.rents}" class="text-center">
        <td class="py-2">
          <span th:text="${rent.rentCode}">R-00005</span><br>
          <a th:href="@{/admin/v1/rents/{rentId}(rentId=${rent.rentCode})}"
             class="mt-1 text-sm text-blue-600 underline">ìƒì„¸ì •ë³´</a>
        </td>
        <td class="py-2" th:text="${rent.userName}">í™ê¸¸ë™</td>
        <td class="py-2" th:text="${rent.bookCode}">D-0005</td>
        <td class="py-2 text-left flex items-center space-x-2">
          <img th:src="${rent.bookThumbnail ?: 'https://picsum.photos/40?5'}"
               class="w-10 h-10" alt="ì¸ë„¤ì¼">
          <span th:text="${rent.bookName}">ì»´í“¨í„°ë³´ì•ˆ</span>
        </td>
        <td class="py-2" th:text="${rent.userPhone}">010-1234-5555</td>
        <td class="py-2">
          <span th:text="${rent.rentDate != null ? #temporals.format(rent.rentDate, 'yyyy-MM-dd') : ''}">2025-06-19</span><br>
          <span class="text-gray-400"
                th:text="${rent.dueDate != null ? '(' + #temporals.format(rent.dueDate, 'yyyy-MM-dd') + ')' : ''}">
                (2025-06-26)
              </span>
        </td>
        <td class="py-2">
          <div th:switch="${rent.rentStatus}">
            <div th:case="'OVERDUE'" class="text-red-600">ë¯¸ë‚©ì¤‘</div>
            <div th:case="'REQUESTED'" class="text-blue-600">ëŒ€ì—¬ìš”ì²­</div>
            <div th:case="'RETURNED'" class="text-gray-600">ë°˜ë‚©</div>
            <div th:case="'REJECTED'" class="text-gray-600">ê±°ì ˆ</div>
            <div th:case="*">ëŒ€ì—¬ì¤‘</div>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- ê°œì„ ëœ í˜ì´ì§€ë„¤ì´ì…˜ -->
  <div class="flex justify-center mt-6">
    <nav class="inline-flex space-x-1">
      <span th:if="${rents.totalPages > 1}">
        <!-- ì²« í˜ì´ì§€ (í•­ìƒ í‘œì‹œ, ì²« í˜ì´ì§€ì¼ ë•Œ ë¹„í™œì„±í™”) -->
        <a th:if="${rents.page > 0}"
           th:href="@{/admin/v1/rents/search(page=0, size=${rents.size}, searchType=${searchCondition?.searchType}, searchKeyword=${searchCondition?.searchKeyword})}"
           class="px-3 py-2 bg-white border rounded hover:bg-gray-100">ì²˜ìŒ</a>
        <span th:unless="${rents.page > 0}"
              class="px-3 py-2 bg-gray-100 border rounded text-gray-400 cursor-not-allowed">ì²˜ìŒ</span>

        <!-- ì´ì „ í˜ì´ì§€ (í•­ìƒ í‘œì‹œ, ì²« í˜ì´ì§€ì¼ ë•Œ ë¹„í™œì„±í™”) -->
        <a th:if="${rents.page > 0}"
           th:href="@{/admin/v1/rents/search(page=${rents.page - 1}, size=${rents.size}, searchType=${searchCondition?.searchType}, searchKeyword=${searchCondition?.searchKeyword})}"
           class="px-3 py-2 bg-white border rounded hover:bg-gray-100">ì´ì „</a>
        <span th:unless="${rents.page > 0}"
              class="px-3 py-2 bg-gray-100 border rounded text-gray-400 cursor-not-allowed">ì´ì „</span>

        <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ (í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ ì¢Œìš° 5ê°œì”©) -->
        <span th:with="startPage=${T(java.lang.Math).max(0, rents.page - 5)},
                       endPage=${T(java.lang.Math).min(rents.totalPages - 1, rents.page + 5)}">

          <!-- ì‹œì‘ í˜ì´ì§€ê°€ 0ì´ ì•„ë‹ˆë©´ ... í‘œì‹œ -->
          <span th:if="${startPage > 0}">
            <a th:href="@{/admin/v1/rents/search(page=0, size=${rents.size}, searchType=${searchCondition?.searchType}, searchKeyword=${searchCondition?.searchKeyword})}"
               class="px-3 py-2 bg-white border rounded hover:bg-gray-100">1</a>
            <span th:if="${startPage > 1}" class="px-3 py-2">...</span>
          </span>

          <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ -->
          <span th:each="i : ${#numbers.sequence(startPage, endPage)}">
            <a th:if="${i == rents.page}"
               th:text="${i + 1}"
               class="px-3 py-2 bg-blue-500 text-white rounded font-semibold">1</a>
            <a th:unless="${i == rents.page}"
               th:href="@{/admin/v1/rents/search(page=${i}, size=${rents.size}, searchType=${searchCondition?.searchType}, searchKeyword=${searchCondition?.searchKeyword})}"
               th:text="${i + 1}"
               class="px-3 py-2 bg-white border rounded hover:bg-gray-100">1</a>
          </span>

          <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ì „ì²´ í˜ì´ì§€ë³´ë‹¤ ì‘ìœ¼ë©´ ... í‘œì‹œ -->
          <span th:if="${endPage < rents.totalPages - 1}">
            <span th:if="${endPage < rents.totalPages - 2}" class="px-3 py-2">...</span>
            <a th:href="@{/admin/v1/rents/search(page=${rents.totalPages - 1}, size=${rents.size}, searchType=${searchCondition?.searchType}, searchKeyword=${searchCondition?.searchKeyword})}"
               th:text="${rents.totalPages}"
               class="px-3 py-2 bg-white border rounded hover:bg-gray-100">ë§ˆì§€ë§‰</a>
          </span>
        </span>

        <!-- ë‹¤ìŒ í˜ì´ì§€ (í•­ìƒ í‘œì‹œ, ë§ˆì§€ë§‰ í˜ì´ì§€ì¼ ë•Œ ë¹„í™œì„±í™”) -->
        <a th:if="${rents.page < rents.totalPages - 1}"
           th:href="@{/admin/v1/rents/search(page=${rents.page + 1}, size=${rents.size}, searchType=${searchCondition?.searchType}, searchKeyword=${searchCondition?.searchKeyword})}"
           class="px-3 py-2 bg-white border rounded hover:bg-gray-100">ë‹¤ìŒ</a>
        <span th:unless="${rents.page < rents.totalPages - 1}"
              class="px-3 py-2 bg-gray-100 border rounded text-gray-400 cursor-not-allowed">ë‹¤ìŒ</span>

        <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ (í•­ìƒ í‘œì‹œ, ë§ˆì§€ë§‰ í˜ì´ì§€ì¼ ë•Œ ë¹„í™œì„±í™”) -->
        <a th:if="${rents.page < rents.totalPages - 1}"
           th:href="@{/admin/v1/rents/search(page=${rents.totalPages - 1}, size=${rents.size}, searchType=${searchCondition?.searchType}, searchKeyword=${searchCondition?.searchKeyword})}"
           class="px-3 py-2 bg-white border rounded hover:bg-gray-100">ë§ˆì§€ë§‰</a>
        <span th:unless="${rents.page < rents.totalPages - 1}"
              class="px-3 py-2 bg-gray-100 border rounded text-gray-400 cursor-not-allowed">ë§ˆì§€ë§‰</span>
      </span>

      <!-- ë°ì´í„°ê°€ ì—†ê±°ë‚˜ 1í˜ì´ì§€ë¿ì¼ ë•Œ -->
      <a th:if="${rents.totalPages <= 1}" href="#" class="px-3 py-2 bg-blue-500 text-white rounded font-semibold">1</a>
    </nav>
  </div>

  <!-- í˜ì´ì§€ ì •ë³´ í‘œì‹œ -->
  <div class="text-center mt-4 text-sm text-gray-500">
    <span th:if="${rents.totalPages > 1}">
      <span th:text="${rents.page + 1}">1</span> / <span th:text="${rents.totalPages}">10</span> í˜ì´ì§€
      (ì´ <span th:text="${rents.totalCount}">50</span>ê°œ)
    </span>
  </div>
</main>

<!-- í‘¸í„° -->
<footer class="bg-white border-t mt-12">
  <div class="max-w-screen-xl mx-auto px-4 py-6 text-center text-sm text-gray-500">
    ìƒí˜¸: ë¶ë§¤ë‹ˆì € | ì „í™”: 010-7294-3724 | ì´ë©”ì¼: admin@bookmanager.com
  </div>
</footer>

<!-- JavaScript -->
<script>
  // ìƒíƒœë³„ í•„í„°ë§
  function filterByStatus(status) {
    const currentUrl = new URL(window.location.href);
    if (status) {
      currentUrl.searchParams.set('rentStatus', status);
    } else {
      currentUrl.searchParams.delete('rentStatus');
    }
    currentUrl.searchParams.set('page', '0');
    window.location.href = currentUrl.toString();
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ ì…€ë ‰íŠ¸ ë°•ìŠ¤ ê°’ ì„¤ì •
  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const rentStatus = urlParams.get('rentStatus');
    if (rentStatus) {
      const statusSelect = document.querySelector('select[onchange="filterByStatus(this.value)"]');
      if (statusSelect) {
        statusSelect.value = rentStatus;
      }
    }
  });
</script>
</body>
</html>