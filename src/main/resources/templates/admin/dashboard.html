<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>λ¶λ§¤λ‹μ €</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @keyframes fade {
      0% {
        opacity: 0.4;
      }
      100% {
        opacity: 1;
      }
    }

    header{position: relative;}
    header>.bg_lnb{
			display: none;
			position: absolute;
			left: 0;
			top: 72px;
			width: 100%;
			height: 120px;
      background-color: rgba(59, 130, 246, 0.06); 
      border-top: 3px solid #3b82f6; 
      border-bottom: 1px solid #bfdbfe;
			animation: fade 0.3s;
    }

    .container{
			position: relative;
    }
    .container>nav{
				position: absolute;
				right: 0;
				top: 32px;
    }

    .container>nav .lnb{
      display: none;
      margin-top: 32px;
      animation: fade 0.3s;
    }
    .container>nav .lnb>li>a{
      display: block;
      height: 30px;
      line-height: 30px;
      
    }
    .container>nav .lnb>li>a:hover{
      color: #fff;
      font-weight: 800;    
      background-color: #3b82f6;
    }


  </style>
  <script src="/Global/js/GlobalNavBarHover.js" defer></script>
</head>
<body class="bg-gray-50">
  <!-- ν—¤λ” -->
  <header th:replace="~{fragments/header :: siteHeader}"></header>

  <!-- λ³Έλ¬Έ -->
  <main class="max-w-screen-xl mx-auto px-4 py-8">
    <h2 class="text-2xl font-bold mb-6">π“ κ΄€λ¦¬μ λ€μ‹λ³΄λ“</h2>
    <div class="grid grid-cols-3 gap-6">
      <!-- λ€μ—¬ν„ν™© -->
      <div class="bg-white rounded shadow p-4">
        <h3 class="font-semibold text-lg mb-2">π“ λ€μ—¬ν„ν™©</h3>
        <ul class="text-sm space-y-1">
          <li>μ¤λμ λ€μ—¬ν„ν™©: <span id="todayRentCount">0</span>κ±΄</li>
          <li>μ΄ λ€μ—¬μ¤‘μΈ λ„μ„ κ¶μ: <span id="totalRentCount">0</span>κ¶</li>
          <li>λ―Έλ‚© λ„μ„ κ¶μ: <span id="overdueRentCount">0</span>κ¶</li>
        </ul>
      </div>
      <!-- ν¬λ§λ„μ„ -->
      <div class="bg-white rounded shadow p-4">
        <h3 class="font-semibold text-lg mb-2">π“– ν¬λ§λ„μ„</h3>
        <ul class="text-sm space-y-1">
          <li>μ‹ μ²­λ λ„μ„ κ¶μ: <span id="totalWish">0</span>κ¶</li>
          <li>μ²λ¦¬λ€κΈ° κ±΄μ: <span id="totalUnsolvedWish">0</span>κ±΄</li>
        </ul>
      </div>

      <!-- λ„μ„κ΄€λ¦¬ -->
      <div class="bg-white rounded shadow p-4">
        <h3 class="font-semibold text-lg mb-2">π“— λ„μ„κ΄€λ¦¬</h3>
        <ul class="text-sm space-y-1">
          <li>μ΄ λ„μ„ μ: <span id="totalBookCount">0</span>κ¶</li>
        </ul>
      </div>

      <!-- νμ›κ΄€λ¦¬ -->
      <div class="bg-white rounded shadow p-4">
        <h3 class="font-semibold text-lg mb-2">π‘¤ νμ›κ΄€λ¦¬</h3>
        <ul class="text-sm space-y-1">
          <li>μ¤λ κ°€μ… νμ› μ: <span id="todayNewUserCount">0</span>λ…</li>
          <li>μ „μ²΄ νμ› μ: <span id="totalUserCount">0</span>λ…</li>
          <li>νƒν‡΄ νμ› μ: <span id="totalWithdrawUserCount">0</span>λ…</li>
        </ul>
      </div>

      <!-- κ΄€λ¦¬μ -->
      <div class="bg-white rounded shadow p-4">
        <h3 class="font-semibold text-lg mb-2">π” κ΄€λ¦¬μ</h3>
        <ul class="text-sm space-y-1">
          <li>λ“±λ΅λ κ΄€λ¦¬μ μ: <span id="adminCount">0</span>λ…</li>
        </ul>
      </div>

      <!-- κ²μ‹ν -->
      <div class="bg-white rounded shadow p-4">
        <h3 class="font-semibold text-lg mb-2">π“¬ κ²μ‹ν</h3>
        <ul class="text-sm space-y-1">
          <li>μ΄ λ„μ„λ¬Έμ: <span id="totalQuestions" >0</span>κ±΄</li>
          <li>λ―Έν•΄κ²°λ λ„μ„λ¬Έμ: <span id="totalUnsolvedQuestions">0</span>κ±΄</li>
          <li>μ΄ μ¤λ¥μ‹ κ³ : <span id="totalReports">0</span>κ±΄</li>
          <li>λ―Έν•΄κ²°λ μ¤λ¥μ‹ κ³ : <span id="totalUnsolvedReports">0</span>κ±΄</li>
        </ul>
      </div>
    </div>
  </main>
  <!-- ν‘Έν„° -->
  <footer class="bg-white border-t mt-12">
    <div class="max-w-screen-xl mx-auto px-4 py-6 text-center text-sm text-gray-500">
      μƒνΈ: λ¶λ§¤λ‹μ € | μ „ν™”: 010-7294-3724 | μ΄λ©”μΌ: admin@bookmanager.com
    </div>
  </footer>


  <script>

    if (true) {
      const $gnb = document.querySelector('header .gnb');
      const $lnbs = document.querySelectorAll('header .lnb');
      const $bg_lnb = document.querySelector('.bg_lnb');

      const navFadeIn = function () {
        $bg_lnb.style.display = 'block';

        $lnbs.forEach(function ($lnb) {
          $lnb.style.display = 'block';
        });
      };

      const navFadeOut = function () {
        $bg_lnb.style.display = 'none';

        $lnbs.forEach(function ($lnb) {
          $lnb.style.display = 'none';
        });
      };

      $gnb.addEventListener('mouseenter', function () {
        navFadeIn();
      });

      $gnb.addEventListener('mouseleave', function () {
        navFadeOut();
      });

      $bg_lnb.addEventListener('mouseover', function () {
        navFadeIn();
      });

      $bg_lnb.addEventListener('mouseout', function () {
        navFadeOut();
      });
    }

  </script>
  <script>
    // νμ΄μ§€ λ΅λ“ ν›„ μ‹¤ν–‰
    const baseUrl = 'http://localhost:8080'
    const apis = [baseUrl + '/admin/v1/rents/status',
                  baseUrl + '/admin/wish/status',
                  baseUrl + '/admin/v1/books/status',
                  baseUrl + '/admin/user/status',
                  baseUrl + '/admin/admins/status',
                  baseUrl + '/admin/question/status']

    window.addEventListener('DOMContentLoaded', async () => {
      try {
        const results = await Promise.all(
                apis.map(async (url) => {
                  const res = await fetch(url);
                  if (!res.ok) throw new Error(`${url} μ‘λ‹µ μ¤λ¥`);
                  const json = await res.json();
                  console.log(json);
                  return json.data;
                })
        );
        // κ²°κ³Ό μνν•΄μ„ ν‚¤-κ°’μΌλ΅ DOM κ°±μ‹ 
        results.forEach(data => {
          Object.entries(data).forEach(([key, value]) => {
            const el = document.getElementById(key);
            if (el) {
              el.textContent = value;
            } else {
              console.warn(`ID=${key}μΈ μ”μ†λ¥Ό μ°Ύμ„ μ μ—†μ`);
            }
          });
        });

      } catch (error) {
        console.error('λ€μ‹λ³΄λ“ λ°μ΄ν„° λ΅λ“ μ‹¤ν¨:', error);
      }

    });
  </script>
</body>
</html>
