<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <title>ë¶ë§¤ë‹ˆì €</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      @keyframes fade {
        0% {
          opacity: 0.4;
        }
        100% {
          opacity: 1;
        }
      }

      header {
        position: relative;
      }
      header > .bg_lnb {
        display: none;
        position: absolute;
        left: 0;
        top: 72px;
        width: 100%;
        height: 120px;
        background-color: rgba(59, 130, 246, 0.06);
        border-top: 3px solid #3b82f6;
        border-bottom: 1px solid #bfdbfe;
        animation: fade 0.3s;
      }

      .container {
        position: relative;
      }
      .container > nav {
        position: absolute;
        right: 0;
        top: 32px;
      }

      .container > nav .lnb {
        display: none;
        margin-top: 32px;
        animation: fade 0.3s;
      }
      .container > nav .lnb > li > a {
        display: block;
        height: 30px;
        line-height: 30px;
      }
      .container > nav .lnb > li > a:hover {
        color: #fff;
        font-weight: 800;
        background-color: #3b82f6;
      }
    </style>
    <script src="/Global/js/GlobalNavBarHover.js" defer></script>
  </head>
  <body class="bg-gray-50">
    <!-- í—¤ë” -->
    <header th:replace="~{fragments/header :: siteHeader}"></header>

    <!-- ë³¸ë¬¸ -->
    <main class="max-w-screen-xl mx-auto px-4 py-8">
      <h2 class="text-2xl font-bold mb-6">ğŸ‘¤ íšŒì›ì •ë³´</h2>

      <!-- íƒˆí‡´ì‹ ì²­/ì·¨ì†Œ ë²„íŠ¼ -->
      <div class="mb-6 text-right">
        <button
                th:if="${userInfo.status == 'ì •ìƒ íšŒì›'}"
                th:attr="data-user-id=${userInfo.userId}"
                onclick="deleteUser(this)"
                class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
          íƒˆí‡´
        </button>

        <button
                th:if="${userInfo.status == 'íƒˆí‡´ íšŒì›'}"
                th:attr="data-user-id=${userInfo.userId}"
                onclick="restoreUser(this)"
                class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
          íƒˆí‡´ ì·¨ì†Œ
        </button>
      </div>

      <!-- íšŒì› ì •ë³´ í¼ -->
      <form class="bg-white p-6 rounded shadow space-y-6">
        <div class="grid grid-cols-2 gap-6">
          <div>
            <label class="block text-gray-700 font-medium">ì´ë¦„</label>
            <input
                    type="text"
                    th:value="${userInfo.userName}"
                    class="mt-1 w-full border px-3 py-2 rounded"
                    readonly
            />
          </div>

          <div>
            <label class="block text-gray-700 font-medium">ë¹„ë°€ë²ˆí˜¸</label>
            <input
                    type="password"
                    value="***********"
                    class="mt-1 w-full border px-3 py-2 rounded"
                    readonly
            />
          </div>

          <div>
            <label class="block text-gray-700 font-medium">ì´ë©”ì¼</label>
            <input
                    type="email"
                    th:value="${userInfo.userEmail}"
                    class="mt-1 w-full border px-3 py-2 rounded"
                    readonly
            />
          </div>

          <div>
            <label class="block text-gray-700 font-medium">ì „í™”ë²ˆí˜¸</label>
            <input
                    type="text"
                    th:value="${userInfo.phoneNumber}"
                    class="mt-1 w-full border px-3 py-2 rounded"
                    readonly
            />
          </div>

          <div>
            <label class="block text-gray-700 font-medium">ìƒíƒœ</label>
            <input
                    type="text"
                    th:value="${userInfo.status}"
                    class="mt-1 w-full border px-3 py-2 rounded"
                    readonly
            />
          </div>
        </div>
      </form>
    </main>

    <!-- í‘¸í„° -->
    <footer class="bg-white border-t mt-12">
      <div
        class="max-w-screen-xl mx-auto px-4 py-6 text-center text-sm text-gray-500"
      >
        ìƒí˜¸: ë¶ë§¤ë‹ˆì € | ì „í™”: 010-7294-3724 | ì´ë©”ì¼: admin@bookmanager.com
      </div>
    </footer>
    <script>
      function deleteUser(btn) {
        const userId = btn.getAttribute("data-user-id");

        if (confirm("ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          // âœ… ë©”íƒ€íƒœê·¸ì—ì„œ CSRF í† í°ê³¼ í—¤ë” ì´ë¦„ ì½ê¸°
          const csrfToken = document.querySelector('meta[name="_csrf"]').content;
          const csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;

          fetch(`/admin/user/${userId}`, {
            method: 'DELETE',
            headers: { [csrfHeader]: csrfToken },
            credentials: 'include'
          })
                  .then(res => res.json())
                  .then(data => {
                    if (data.success) {
                      alert("íƒˆí‡´ ì™„ë£Œ");
                      window.location.reload(); // ëª©ë¡ìœ¼ë¡œ ì´ë™
                    } else {
                      alert("íƒˆí‡´ ì‹¤íŒ¨");
                    }
                  });
        }
      }
      function restoreUser(btn) {
        const userId = btn.getAttribute("data-user-id");
        const csrfToken = document.querySelector('meta[name="_csrf"]').content;
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;

        if (confirm("ì •ë§ íƒˆí‡´ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          fetch(`/admin/user/${userId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              [csrfHeader]: csrfToken
            },
            credentials: 'include'
          })
                  .then(res => res.json())
                  .then(data => {
                    if (data.success) {
                      alert("íƒˆí‡´ ì·¨ì†Œ ì™„ë£Œ");
                      window.location.reload();
                    } else {
                      alert("ì·¨ì†Œ ì‹¤íŒ¨");
                    }
                  });
        }
      }
    </script>
  </body>
</html>
